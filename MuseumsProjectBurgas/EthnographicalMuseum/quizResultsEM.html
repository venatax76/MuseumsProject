<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ethnographical Museum â€” Results</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body{height:100%}
    body{margin:0;display:flex;align-items:center;justify-content:center;font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;background:linear-gradient(135deg,#fff8ec 0%,#f6efe6 100%)}
    .box{background:#fff;padding:1.8rem;border-radius:14px;max-width:620px;width:100%;box-shadow:0 12px 30px rgba(0,0,0,.08);position:relative;text-align:center}
    .lang{position:absolute;top:12px;right:12px;display:flex;gap:.4rem;z-index:10}
    .lang button{background:#fff7ed;border:2px solid #e6b089;padding:.3rem .7rem;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.2s ease}
    .lang button:hover{background:#ffe0b2}
    .lang button.active{background:#e6b089;color:#fff;box-shadow:0 4px 12px rgba(230,176,137,0.4)}
    h2{color:#6b3f00;margin-top:0;margin-bottom:0.8rem}
    .score{font-size:1.3rem;color:#4b2e13;margin:.6rem 0;font-weight:600}
    .message{font-size:1.15rem;color:#d18a3b;margin:1rem 0;font-weight:600;line-height:1.5}
    .details{margin-top:1rem;text-align:left;background:#fff3e8;padding:1.2rem;border-radius:12px;max-height:380px;overflow-y:auto;display:none}
    .details strong{color:#e76f51;font-size:1rem;display:block;margin-bottom:1rem}
    .mistake-item{margin-bottom:1rem;padding:0.9rem;background:#fff;border-left:4px solid #e76f51;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
    .mistake-item strong{color:#4b2e13;display:block;margin-bottom:0.5rem;font-size:0.95rem}
    .mistake-item p{margin:0.4rem 0;font-size:0.95rem;color:#4b2e13;line-height:1.4}
    .mistake-item p.user{color:#e76f51}
    .mistake-item p.correct{color:#38a169}
    .btn{display:block;margin:1rem auto 0 auto;padding:.6rem 1.2rem;border-radius:10px;border:none;background:linear-gradient(90deg,#d18a3b,#e6b089);color:#fff;cursor:pointer;font-weight:600;transition:all 0.2s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 16px rgba(209,138,59,0.3)}
  </style>
</head>
<body>
  <div class="box">
    <div class="lang">
      <button id="btn-en" onclick="setLang('en')">EN</button>
      <button id="btn-bg" onclick="setLang('bg')">BG</button>
    </div>

    <h2 id="results-title">Quiz Results</h2>
    <div class="score" id="score"></div>
    <div class="msg" id="message"></div>

    <div class="details" id="details" style="display:none"></div>

    <button class="btn" id="restart">Back to start</button>
  </div>

<script>
const translations = {
  en:{
    results:"Quiz Results",
    wellDone:"Perfect! You are a true ethnographer! ðŸŽ‰",
    messages:[
      { min:0, max:20, text:"Don't worry! Keep learning and you'll improve. ðŸ’ª" },
      { min:20, max:40, text:"Good effort! ðŸ“š" },
      { min:40, max:60, text:"Nice work! You're on the right track. Keep going! ðŸŒŸ" },
      { min:60, max:80, text:"Very good! Almost there! ðŸš€" },
      { min:80, max:100, text:"Excellent! You really know your stuff! ðŸ‘" }
    ],
    back:"Back to start",
    mistakes:"Your Mistakes:",
    yourAnswer:"Your answer:",
    correctAnswer:"Correct answer:"
  },
  bg:{
    results:"Ð ÐµÐ·ÑƒÐ»Ñ‚Ð°Ñ‚Ð¸ Ð¾Ñ‚ Ð²Ð¸ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð°Ñ‚Ð°",
    wellDone:"ÐŸÐµÑ€Ñ„ÐµÐºÑ‚Ð½Ð¾! Ð’Ð¸Ðµ ÑÑ‚Ðµ Ð¸ÑÑ‚Ð¸Ð½ÑÐºÐ¸ ÐµÑ‚Ð½Ð¾Ð³Ñ€Ð°Ñ„! ðŸŽ‰",
    messages:[
      { min:0, max:20, text:"ÐÐµ ÑÐµ Ð¿Ñ€Ð¸Ñ‚ÐµÑÐ½ÑÐ²Ð°Ð¹Ñ‚Ðµ! ÐžÐ¿Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ Ð¾Ñ‚Ð½Ð¾Ð²Ð¾ ðŸ’ª" },
      { min:20, max:40, text:"Ð”Ð¾Ð±ÑŠÑ€ Ð¾Ð¿Ð¸Ñ‚!ðŸ“š" },
      { min:40, max:60, text:"Ð”Ð¾Ð±ÑŠÑ€ Ð¾Ð¿Ð¸Ñ‚! ðŸŒŸ" },
      { min:60, max:80, text:"ÐœÐ½Ð¾Ð³Ð¾ Ð´Ð¾Ð±Ñ€Ðµ! ðŸš€" },
      { min:80, max:100, text:"ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! ÐÐ°Ð¸ÑÑ‚Ð¸Ð½Ð° Ð·Ð½Ð°ÐµÑ‚Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°! ðŸ‘" }
    ],
    back:"ÐÐ°Ð·Ð°Ð´ ÐºÑŠÐ¼ Ð½Ð°Ñ‡Ð°Ð»Ð¾Ñ‚Ð¾",
    mistakes:"Ð’Ð°ÑˆÐ¸Ñ‚Ðµ Ð³Ñ€ÐµÑˆÐºÐ¸:",
    yourAnswer:"Ð’Ð°ÑˆÐ¸ÑÑ‚ Ð¾Ñ‚Ð³Ð¾Ð²Ð¾Ñ€:",
    correctAnswer:"ÐŸÑ€Ð°Ð²Ð¸Ð»ÐµÐ½ Ð¾Ñ‚Ð³Ð¾Ð²Ð¾Ñ€:"
  }
};

let lang = localStorage.getItem('language') || 'en';
function setLang(l){ lang = l; localStorage.setItem('language', l); render(); }

document.getElementById('restart').addEventListener('click', ()=>{
  localStorage.removeItem('correctAnswersEM');
  localStorage.removeItem('userAnswersEM');
  window.location.href = 'welcomeEthnographicalMuseum.html';
});

function normalize(s){ return (s||"").toString().trim().toLowerCase(); }

function render(){
  document.getElementById('btn-en').classList.toggle('active', lang==='en');
  document.getElementById('btn-bg').classList.toggle('active', lang==='bg');
  document.getElementById('results-title').textContent = translations[lang].results;
  document.getElementById('restart').textContent = translations[lang].back;

  const correct = JSON.parse(localStorage.getItem('correctAnswersEM') || '[]');
  const user = JSON.parse(localStorage.getItem('userAnswersEM') || '[]');
  let correctCount = 0;
  const mistakes = [];

  for(let i=0;i<correct.length;i++){
    const accepted = correct[i] || [];
    const u = user[i] || "";
    const ok = accepted.some(a => normalize(a) === normalize(u));
    if(ok) {
      correctCount++;
    } else {
      mistakes.push({n:i+1, user:u, correct:accepted});
    }
  }

  document.getElementById('score').textContent = correctCount + " / " + correct.length;

  let messageText;
  if(correctCount === correct.length) {
    messageText = translations[lang].wellDone;
  } else {
    const percentage = (correctCount / correct.length) * 100;
    const msg = translations[lang].messages.find(m => percentage >= m.min && percentage < m.max);
    messageText = msg ? msg.text : translations[lang].messages[0].text;
  }
  document.getElementById('message').textContent = messageText;

  if(mistakes.length){
    const el = document.getElementById('details');
    el.style.display = 'block';
    el.innerHTML = '<strong>' + translations[lang].mistakes + '</strong>' + mistakes.map(m => {
      return '<div class="mistake-item"><strong>Question #' + m.n + '</strong><p class="user"><strong>' + translations[lang].yourAnswer + '</strong> <em>' + (m.user||'Not answered') + '</em></p><p class="correct"><strong>' + translations[lang].correctAnswer + '</strong> <em>' + m.correct.join(', ') + '</em></p></div>';
    }).join('');
  } else {
    document.getElementById('details').style.display = 'none';
  }
}

/* initial render */
render();
</script>